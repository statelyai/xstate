<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>è°ƒç”¨ Services | XState æ–‡æ¡£</title>
    <meta name="generator" content="VuePress 1.8.2">
    <script src="https://plausible.io/js/plausible.js" defer="defer"></script>
    <meta name="description" content="XState æ–‡æ¡£ï¼šç°ä»£ Web çš„çŠ¶æ€æœºå’ŒçŠ¶æ€å›¾">
    
    <link rel="preload" href="/docs/assets/css/0.styles.8a221dd5.css" as="style"><link rel="preload" href="/docs/assets/js/app.b1166240.js" as="script"><link rel="preload" href="/docs/assets/js/3.0f500953.js" as="script"><link rel="preload" href="/docs/assets/js/12.91d2277e.js" as="script"><link rel="preload" href="/docs/assets/js/175.dde208a1.js" as="script"><link rel="preload" href="/docs/assets/js/13.849ee94d.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.1c53c5e1.js"><link rel="prefetch" href="/docs/assets/js/100.058985b8.js"><link rel="prefetch" href="/docs/assets/js/101.7e5c6308.js"><link rel="prefetch" href="/docs/assets/js/102.41c20b2b.js"><link rel="prefetch" href="/docs/assets/js/103.3390bb0f.js"><link rel="prefetch" href="/docs/assets/js/104.1a0547a1.js"><link rel="prefetch" href="/docs/assets/js/105.b2c564e9.js"><link rel="prefetch" href="/docs/assets/js/106.8dc7c06c.js"><link rel="prefetch" href="/docs/assets/js/107.4c7952ce.js"><link rel="prefetch" href="/docs/assets/js/108.2009f7ca.js"><link rel="prefetch" href="/docs/assets/js/109.6967c4d6.js"><link rel="prefetch" href="/docs/assets/js/11.87881b49.js"><link rel="prefetch" href="/docs/assets/js/110.788f7ef9.js"><link rel="prefetch" href="/docs/assets/js/111.bd37b286.js"><link rel="prefetch" href="/docs/assets/js/112.6b30ba41.js"><link rel="prefetch" href="/docs/assets/js/113.936feaf3.js"><link rel="prefetch" href="/docs/assets/js/114.17c2ddd1.js"><link rel="prefetch" href="/docs/assets/js/115.e99f1d85.js"><link rel="prefetch" href="/docs/assets/js/116.3834bde2.js"><link rel="prefetch" href="/docs/assets/js/117.1783296a.js"><link rel="prefetch" href="/docs/assets/js/118.de4021fb.js"><link rel="prefetch" href="/docs/assets/js/119.9ce6108a.js"><link rel="prefetch" href="/docs/assets/js/120.aa3cb15d.js"><link rel="prefetch" href="/docs/assets/js/121.090cd0eb.js"><link rel="prefetch" href="/docs/assets/js/122.669c9b9a.js"><link rel="prefetch" href="/docs/assets/js/123.9340349e.js"><link rel="prefetch" href="/docs/assets/js/124.82bf248f.js"><link rel="prefetch" href="/docs/assets/js/125.c2183726.js"><link rel="prefetch" href="/docs/assets/js/126.b80164ce.js"><link rel="prefetch" href="/docs/assets/js/127.da474367.js"><link rel="prefetch" href="/docs/assets/js/128.88a5c0e8.js"><link rel="prefetch" href="/docs/assets/js/129.fa3aa9f0.js"><link rel="prefetch" href="/docs/assets/js/130.9715c88c.js"><link rel="prefetch" href="/docs/assets/js/131.750a04c4.js"><link rel="prefetch" href="/docs/assets/js/132.972e86e3.js"><link rel="prefetch" href="/docs/assets/js/133.d3b4a907.js"><link rel="prefetch" href="/docs/assets/js/134.86ebc8c3.js"><link rel="prefetch" href="/docs/assets/js/135.99f64b59.js"><link rel="prefetch" href="/docs/assets/js/136.e3c083b3.js"><link rel="prefetch" href="/docs/assets/js/137.bd2c5dee.js"><link rel="prefetch" href="/docs/assets/js/138.97f53f5a.js"><link rel="prefetch" href="/docs/assets/js/139.b5fd536b.js"><link rel="prefetch" href="/docs/assets/js/14.b73ae4c4.js"><link rel="prefetch" href="/docs/assets/js/140.e39a7ce9.js"><link rel="prefetch" href="/docs/assets/js/141.0cca46f5.js"><link rel="prefetch" href="/docs/assets/js/142.8a68be41.js"><link rel="prefetch" href="/docs/assets/js/143.1a91f081.js"><link rel="prefetch" href="/docs/assets/js/144.1f6897f2.js"><link rel="prefetch" href="/docs/assets/js/145.2ac2084e.js"><link rel="prefetch" href="/docs/assets/js/146.2ff18753.js"><link rel="prefetch" href="/docs/assets/js/147.509adb0e.js"><link rel="prefetch" href="/docs/assets/js/148.05d872b2.js"><link rel="prefetch" href="/docs/assets/js/149.67eb4722.js"><link rel="prefetch" href="/docs/assets/js/15.33ce7b11.js"><link rel="prefetch" href="/docs/assets/js/150.7faa190b.js"><link rel="prefetch" href="/docs/assets/js/151.9cf5cdf2.js"><link rel="prefetch" href="/docs/assets/js/152.3cb63d70.js"><link rel="prefetch" href="/docs/assets/js/153.6e22519c.js"><link rel="prefetch" href="/docs/assets/js/154.5f8dfe8a.js"><link rel="prefetch" href="/docs/assets/js/155.3a5b901c.js"><link rel="prefetch" href="/docs/assets/js/156.d8fabe92.js"><link rel="prefetch" href="/docs/assets/js/157.6b1bd8fd.js"><link rel="prefetch" href="/docs/assets/js/158.d80a7e6f.js"><link rel="prefetch" href="/docs/assets/js/159.30415db1.js"><link rel="prefetch" href="/docs/assets/js/16.79901385.js"><link rel="prefetch" href="/docs/assets/js/160.02a47b36.js"><link rel="prefetch" href="/docs/assets/js/161.3b10566c.js"><link rel="prefetch" href="/docs/assets/js/162.6fafcec3.js"><link rel="prefetch" href="/docs/assets/js/163.39fd0205.js"><link rel="prefetch" href="/docs/assets/js/164.c1b95846.js"><link rel="prefetch" href="/docs/assets/js/165.94f171bd.js"><link rel="prefetch" href="/docs/assets/js/166.1b07cf91.js"><link rel="prefetch" href="/docs/assets/js/167.3e1d20e0.js"><link rel="prefetch" href="/docs/assets/js/168.9e358920.js"><link rel="prefetch" href="/docs/assets/js/169.d0cb7ebd.js"><link rel="prefetch" href="/docs/assets/js/17.72da34a1.js"><link rel="prefetch" href="/docs/assets/js/170.cfa804e7.js"><link rel="prefetch" href="/docs/assets/js/171.a93a0675.js"><link rel="prefetch" href="/docs/assets/js/172.8a352738.js"><link rel="prefetch" href="/docs/assets/js/173.535d4602.js"><link rel="prefetch" href="/docs/assets/js/174.d901f558.js"><link rel="prefetch" href="/docs/assets/js/176.918519b6.js"><link rel="prefetch" href="/docs/assets/js/177.071ded81.js"><link rel="prefetch" href="/docs/assets/js/178.1977769d.js"><link rel="prefetch" href="/docs/assets/js/179.8ab6ae61.js"><link rel="prefetch" href="/docs/assets/js/18.e75e8faa.js"><link rel="prefetch" href="/docs/assets/js/180.c1656fe9.js"><link rel="prefetch" href="/docs/assets/js/181.fafbe561.js"><link rel="prefetch" href="/docs/assets/js/182.cfe2dd5c.js"><link rel="prefetch" href="/docs/assets/js/183.1e0dc4b0.js"><link rel="prefetch" href="/docs/assets/js/184.7e1a6cc4.js"><link rel="prefetch" href="/docs/assets/js/185.a0d5e352.js"><link rel="prefetch" href="/docs/assets/js/186.b0be58c8.js"><link rel="prefetch" href="/docs/assets/js/187.83b2e52a.js"><link rel="prefetch" href="/docs/assets/js/188.7e55f9d2.js"><link rel="prefetch" href="/docs/assets/js/189.2691869f.js"><link rel="prefetch" href="/docs/assets/js/19.9ed243e2.js"><link rel="prefetch" href="/docs/assets/js/190.a4d2ce64.js"><link rel="prefetch" href="/docs/assets/js/191.6a309382.js"><link rel="prefetch" href="/docs/assets/js/192.9f6f957e.js"><link rel="prefetch" href="/docs/assets/js/193.80acbb4d.js"><link rel="prefetch" href="/docs/assets/js/194.d06272e2.js"><link rel="prefetch" href="/docs/assets/js/195.69863b35.js"><link rel="prefetch" href="/docs/assets/js/196.a174ffc4.js"><link rel="prefetch" href="/docs/assets/js/197.b741df5e.js"><link rel="prefetch" href="/docs/assets/js/198.2e43b0fa.js"><link rel="prefetch" href="/docs/assets/js/199.88e0f96f.js"><link rel="prefetch" href="/docs/assets/js/20.c25c6f46.js"><link rel="prefetch" href="/docs/assets/js/200.07db53cf.js"><link rel="prefetch" href="/docs/assets/js/201.4958eb75.js"><link rel="prefetch" href="/docs/assets/js/202.8c1882bc.js"><link rel="prefetch" href="/docs/assets/js/203.9de2b1dd.js"><link rel="prefetch" href="/docs/assets/js/204.b1ed2223.js"><link rel="prefetch" href="/docs/assets/js/205.2b054ba3.js"><link rel="prefetch" href="/docs/assets/js/206.72991636.js"><link rel="prefetch" href="/docs/assets/js/207.0e8606da.js"><link rel="prefetch" href="/docs/assets/js/208.39148668.js"><link rel="prefetch" href="/docs/assets/js/209.37284581.js"><link rel="prefetch" href="/docs/assets/js/21.2797df21.js"><link rel="prefetch" href="/docs/assets/js/210.685802ba.js"><link rel="prefetch" href="/docs/assets/js/211.0fc25c48.js"><link rel="prefetch" href="/docs/assets/js/212.fda94cae.js"><link rel="prefetch" href="/docs/assets/js/213.22171ef7.js"><link rel="prefetch" href="/docs/assets/js/214.3752e0a4.js"><link rel="prefetch" href="/docs/assets/js/215.35078b60.js"><link rel="prefetch" href="/docs/assets/js/216.8374a12d.js"><link rel="prefetch" href="/docs/assets/js/217.dccacdc0.js"><link rel="prefetch" href="/docs/assets/js/218.5a317aaa.js"><link rel="prefetch" href="/docs/assets/js/219.9efc7a53.js"><link rel="prefetch" href="/docs/assets/js/22.c94e4afc.js"><link rel="prefetch" href="/docs/assets/js/220.0f391318.js"><link rel="prefetch" href="/docs/assets/js/221.d0384b20.js"><link rel="prefetch" href="/docs/assets/js/222.0d06ace4.js"><link rel="prefetch" href="/docs/assets/js/223.fb309c20.js"><link rel="prefetch" href="/docs/assets/js/224.7e0a1769.js"><link rel="prefetch" href="/docs/assets/js/225.0333d350.js"><link rel="prefetch" href="/docs/assets/js/226.ab724e96.js"><link rel="prefetch" href="/docs/assets/js/227.4c002e7d.js"><link rel="prefetch" href="/docs/assets/js/228.d86b744c.js"><link rel="prefetch" href="/docs/assets/js/229.8a50db9d.js"><link rel="prefetch" href="/docs/assets/js/23.09397c8e.js"><link rel="prefetch" href="/docs/assets/js/24.07404d04.js"><link rel="prefetch" href="/docs/assets/js/25.5eb7321e.js"><link rel="prefetch" href="/docs/assets/js/26.f28aa72b.js"><link rel="prefetch" href="/docs/assets/js/27.6aea7d1e.js"><link rel="prefetch" href="/docs/assets/js/28.f173ff96.js"><link rel="prefetch" href="/docs/assets/js/29.2f7d11f5.js"><link rel="prefetch" href="/docs/assets/js/30.f5bbcc03.js"><link rel="prefetch" href="/docs/assets/js/31.4a84dbcc.js"><link rel="prefetch" href="/docs/assets/js/32.1ac677d7.js"><link rel="prefetch" href="/docs/assets/js/33.9c21566c.js"><link rel="prefetch" href="/docs/assets/js/34.dc7b9a30.js"><link rel="prefetch" href="/docs/assets/js/35.1fa3ac7c.js"><link rel="prefetch" href="/docs/assets/js/36.01fd9ecd.js"><link rel="prefetch" href="/docs/assets/js/37.138a7d50.js"><link rel="prefetch" href="/docs/assets/js/38.baea50c2.js"><link rel="prefetch" href="/docs/assets/js/39.bc44548f.js"><link rel="prefetch" href="/docs/assets/js/4.9ae53091.js"><link rel="prefetch" href="/docs/assets/js/40.be96ae64.js"><link rel="prefetch" href="/docs/assets/js/41.0f1b6855.js"><link rel="prefetch" href="/docs/assets/js/42.e1362e40.js"><link rel="prefetch" href="/docs/assets/js/43.32066367.js"><link rel="prefetch" href="/docs/assets/js/44.57c094f1.js"><link rel="prefetch" href="/docs/assets/js/45.ecf450bc.js"><link rel="prefetch" href="/docs/assets/js/46.0f7cd87e.js"><link rel="prefetch" href="/docs/assets/js/47.b6c9ac06.js"><link rel="prefetch" href="/docs/assets/js/48.674df931.js"><link rel="prefetch" href="/docs/assets/js/49.1a47080b.js"><link rel="prefetch" href="/docs/assets/js/5.b5ba5f53.js"><link rel="prefetch" href="/docs/assets/js/50.1f845dfc.js"><link rel="prefetch" href="/docs/assets/js/51.99c74a75.js"><link rel="prefetch" href="/docs/assets/js/52.68103fc2.js"><link rel="prefetch" href="/docs/assets/js/53.7a724eb3.js"><link rel="prefetch" href="/docs/assets/js/54.02a99ba8.js"><link rel="prefetch" href="/docs/assets/js/55.12164426.js"><link rel="prefetch" href="/docs/assets/js/56.0cd63326.js"><link rel="prefetch" href="/docs/assets/js/57.cc940e9e.js"><link rel="prefetch" href="/docs/assets/js/58.14e1598b.js"><link rel="prefetch" href="/docs/assets/js/59.f42267cd.js"><link rel="prefetch" href="/docs/assets/js/6.c5430922.js"><link rel="prefetch" href="/docs/assets/js/60.3634c03d.js"><link rel="prefetch" href="/docs/assets/js/61.91ce7c90.js"><link rel="prefetch" href="/docs/assets/js/62.01fa31a1.js"><link rel="prefetch" href="/docs/assets/js/63.56e8e6e6.js"><link rel="prefetch" href="/docs/assets/js/64.378ef981.js"><link rel="prefetch" href="/docs/assets/js/65.af446493.js"><link rel="prefetch" href="/docs/assets/js/66.e78366d5.js"><link rel="prefetch" href="/docs/assets/js/67.bf70ad7a.js"><link rel="prefetch" href="/docs/assets/js/68.fc18590e.js"><link rel="prefetch" href="/docs/assets/js/69.44e39a68.js"><link rel="prefetch" href="/docs/assets/js/7.506ca2b4.js"><link rel="prefetch" href="/docs/assets/js/70.92d2c5ad.js"><link rel="prefetch" href="/docs/assets/js/71.6b6fa5d0.js"><link rel="prefetch" href="/docs/assets/js/72.b399fc1e.js"><link rel="prefetch" href="/docs/assets/js/73.79066a06.js"><link rel="prefetch" href="/docs/assets/js/74.c09f5550.js"><link rel="prefetch" href="/docs/assets/js/75.23bc6b26.js"><link rel="prefetch" href="/docs/assets/js/76.d7c634e0.js"><link rel="prefetch" href="/docs/assets/js/77.342dd87d.js"><link rel="prefetch" href="/docs/assets/js/78.d78e5e0e.js"><link rel="prefetch" href="/docs/assets/js/79.28174585.js"><link rel="prefetch" href="/docs/assets/js/8.d2121246.js"><link rel="prefetch" href="/docs/assets/js/80.2a2555db.js"><link rel="prefetch" href="/docs/assets/js/81.82bee833.js"><link rel="prefetch" href="/docs/assets/js/82.1748c3f3.js"><link rel="prefetch" href="/docs/assets/js/83.332ee3d8.js"><link rel="prefetch" href="/docs/assets/js/84.9841814a.js"><link rel="prefetch" href="/docs/assets/js/85.f5277739.js"><link rel="prefetch" href="/docs/assets/js/86.b93310ee.js"><link rel="prefetch" href="/docs/assets/js/87.4c4e8d2f.js"><link rel="prefetch" href="/docs/assets/js/88.4a5dd5e6.js"><link rel="prefetch" href="/docs/assets/js/89.0bed5ecb.js"><link rel="prefetch" href="/docs/assets/js/9.ed9f275e.js"><link rel="prefetch" href="/docs/assets/js/90.4cf02519.js"><link rel="prefetch" href="/docs/assets/js/91.7dadc6ff.js"><link rel="prefetch" href="/docs/assets/js/92.2eae2d6c.js"><link rel="prefetch" href="/docs/assets/js/93.446d8ed5.js"><link rel="prefetch" href="/docs/assets/js/94.4257273f.js"><link rel="prefetch" href="/docs/assets/js/95.ccaea0b2.js"><link rel="prefetch" href="/docs/assets/js/96.460690c0.js"><link rel="prefetch" href="/docs/assets/js/97.9439ad83.js"><link rel="prefetch" href="/docs/assets/js/98.8be9618e.js"><link rel="prefetch" href="/docs/assets/js/99.f3cff76a.js"><link rel="prefetch" href="/docs/assets/js/vendors~docsearch.00c8f6e8.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.8a221dd5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/zh/" class="home-link router-link-active"><img src="/docs/logo.svg" alt="XState æ–‡æ¡£" class="logo"> <span class="site-name can-hide">XState æ–‡æ¡£</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://paka.dev/npm/xstate/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  API
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://stately.ai/viz" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å¯è§†åŒ–å·¥å…·
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://discord.gg/xtWgFTgvNV" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/statelyai/xstate/discussions" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ç¤¾åŒº
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">é€‰æ‹©è¯­è¨€</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">é€‰æ‹©è¯­è¨€</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/guides/communication.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/docs/zh/guides/communication.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  ç®€ä½“ä¸­æ–‡
</a></li><li class="dropdown-item"><!----> <a href="/docs/fr/guides/communication.html" class="nav-link">
  FranÃ§ais
</a></li></ul></div></div> <a href="https://github.com/davidkpiano/xstate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://paka.dev/npm/xstate/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  API
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://stately.ai/viz" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å¯è§†åŒ–å·¥å…·
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://discord.gg/xtWgFTgvNV" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/statelyai/xstate/discussions" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ç¤¾åŒº
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">é€‰æ‹©è¯­è¨€</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">é€‰æ‹©è¯­è¨€</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/guides/communication.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/docs/zh/guides/communication.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  ç®€ä½“ä¸­æ–‡
</a></li><li class="dropdown-item"><!----> <a href="/docs/fr/guides/communication.html" class="nav-link">
  FranÃ§ais
</a></li></ul></div></div> <a href="https://github.com/davidkpiano/xstate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ä»€ä¹ˆæ˜¯ XState?</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å…³äº</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>å‘å¯¼</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/zh/guides/start.html" class="sidebar-link">å…¥é—¨</a></li><li><a href="/docs/zh/guides/installation.html" class="sidebar-link">å®‰è£…</a></li><li><a href="/docs/zh/guides/introduction-to-state-machines-and-statecharts/" class="sidebar-link">çŠ¶æ€æœºå’ŒçŠ¶æ€å›¾ç®€ä»‹</a></li><li><a href="/docs/zh/guides/machines.html" class="sidebar-link">çŠ¶æ€æœº Machines</a></li><li><a href="/docs/zh/guides/states.html" class="sidebar-link">çŠ¶æ€ State</a></li><li><a href="/docs/zh/guides/statenodes.html" class="sidebar-link">çŠ¶æ€èŠ‚ç‚¹</a></li><li><a href="/docs/zh/guides/events.html" class="sidebar-link">äº‹ä»¶ Event</a></li><li><a href="/docs/zh/guides/transitions.html" class="sidebar-link">è½¬æ¢ Transitions</a></li><li><a href="/docs/zh/guides/hierarchical.html" class="sidebar-link">åˆ†å±‚çŠ¶æ€èŠ‚ç‚¹ Hierarchical State Node</a></li><li><a href="/docs/zh/guides/parallel.html" class="sidebar-link">å¹¶è¡ŒçŠ¶æ€èŠ‚ç‚¹ Parallel State Node</a></li><li><a href="/docs/zh/guides/final.html" class="sidebar-link">æœ€ç»ˆçŠ¶æ€</a></li><li><a href="/docs/zh/guides/effects.html" class="sidebar-link">ä½œç”¨ Effects</a></li><li><a href="/docs/zh/guides/actions.html" class="sidebar-link">åŠ¨ä½œ Actions</a></li><li><a href="/docs/zh/guides/guards.html" class="sidebar-link">å®ˆå«ï¼ˆGuardedï¼‰è½¬æ¢</a></li><li><a href="/docs/zh/guides/context.html" class="sidebar-link">ä¸Šä¸‹æ–‡ Context</a></li><li><a href="/docs/zh/guides/models.html" class="sidebar-link">æ¨¡å‹ Models</a></li><li><a href="/docs/zh/guides/activities.html" class="sidebar-link">æ´»åŠ¨ Activities</a></li><li><a href="/docs/zh/guides/communication.html" aria-current="page" class="active sidebar-link">è°ƒç”¨ Services</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/zh/guides/communication.html#invoke-å±æ€§" class="sidebar-link">invoke å±æ€§</a></li><li class="sidebar-sub-header"><a href="/docs/zh/guides/communication.html#è°ƒç”¨-promises" class="sidebar-link">è°ƒç”¨ Promises</a></li><li class="sidebar-sub-header"><a href="/docs/zh/guides/communication.html#è°ƒç”¨-callbacks" class="sidebar-link">è°ƒç”¨ Callbacks</a></li><li class="sidebar-sub-header"><a href="/docs/zh/guides/communication.html#è°ƒç”¨-observables" class="sidebar-link">è°ƒç”¨ Observables</a></li><li class="sidebar-sub-header"><a href="/docs/zh/guides/communication.html#è°ƒç”¨-machines" class="sidebar-link">è°ƒç”¨ Machines</a></li><li class="sidebar-sub-header"><a href="/docs/zh/guides/communication.html#å‘é€å“åº”" class="sidebar-link">å‘é€å“åº”</a></li><li class="sidebar-sub-header"><a href="/docs/zh/guides/communication.html#å¤šæœåŠ¡" class="sidebar-link">å¤šæœåŠ¡</a></li><li class="sidebar-sub-header"><a href="/docs/zh/guides/communication.html#é…ç½®æœåŠ¡" class="sidebar-link">é…ç½®æœåŠ¡</a></li><li class="sidebar-sub-header"><a href="/docs/zh/guides/communication.html#æµ‹è¯•" class="sidebar-link">æµ‹è¯•</a></li><li class="sidebar-sub-header"><a href="/docs/zh/guides/communication.html#å¼•ç”¨æœåŠ¡" class="sidebar-link">å¼•ç”¨æœåŠ¡</a></li><li class="sidebar-sub-header"><a href="/docs/zh/guides/communication.html#å¿«é€Ÿå‚è€ƒ" class="sidebar-link">å¿«é€Ÿå‚è€ƒ</a></li></ul></li><li><a href="/docs/zh/guides/actors.html" class="sidebar-link">æ¼”å‘˜ Actors</a></li><li><a href="/docs/zh/guides/delays.html" class="sidebar-link">å»¶è¿Ÿäº‹ä»¶ å’Œ è½¬æ¢</a></li><li><a href="/docs/zh/guides/history.html" class="sidebar-link">å†å² History</a></li><li><a href="/docs/zh/guides/ids.html" class="sidebar-link">æ ‡è¯† State èŠ‚ç‚¹</a></li><li><a href="/docs/zh/guides/interpretation.html" class="sidebar-link">è§£é‡Šï¼ˆInterpretingï¼‰ çŠ¶æ€æœº</a></li><li><a href="/docs/zh/guides/testing.html" class="sidebar-link">æµ‹è¯•çŠ¶æ€æœº</a></li><li><a href="/docs/zh/guides/typescript.html" class="sidebar-link">ä½¿ç”¨ TypeScript</a></li><li><a href="/docs/zh/guides/scxml.html" class="sidebar-link">SCXML</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ•™ç¨‹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>é…æ–¹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>åŒ…</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ¨¡å¼</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ç¤ºä¾‹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ–°é—»å’Œæœ‰ç”¨åœ°å€</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="è°ƒç”¨-services"><a href="#è°ƒç”¨-services" class="header-anchor">#</a> è°ƒç”¨ Services</h1> <p><a href="#%E5%BF%AB%E9%80%9F%E5%8F%82%E8%80%83">ğŸš€ å¿«é€Ÿå‚è€ƒ</a></p> <p>åœ¨ä¸€å°çŠ¶æ€æœºä¸Šè¡¨è¾¾æ•´ä¸ªåº”ç”¨ç¨‹åºçš„è¡Œä¸ºå¾ˆå¿«å°±ä¼šå˜å¾—å¤æ‚å’Œç¬¨æ‹™ã€‚ ä½¿ç”¨å¤šä¸ªç›¸äº’é€šä¿¡çš„çŠ¶æ€æœºæ¥è¡¨è¾¾å¤æ‚çš„é€»è¾‘æ˜¯å¾ˆè‡ªç„¶çš„ï¼ˆå¹¶ä¸”å—åˆ°é¼“åŠ±ï¼ï¼‰ã€‚ è¿™éå¸¸ç±»ä¼¼äº <a href="https://www.brianstorti.com/the-actor-model/" target="_blank" rel="noopener noreferrer">æ¼”å‘˜ï¼ˆActorï¼‰<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œå…¶ä¸­æ¯ä¸ªçŠ¶æ€æœºå®ä¾‹éƒ½è¢«è§†ä¸ºä¸€ä¸ªâ€œæ¼”å‘˜â€ï¼Œå¯ä»¥å‘å…¶ä»–â€œæ¼”å‘˜â€ï¼ˆä¾‹å¦‚ Promise æˆ–å…¶ä»–çŠ¶æ€æœºï¼‰å‘é€å’Œæ¥æ”¶äº‹ä»¶ï¼ˆæ¶ˆæ¯ï¼‰å¹¶å¯¹å…¶åšå‡ºå“åº” .</p> <p>ä¸ºäº†è®©çŠ¶æ€æœºç›¸äº’é€šä¿¡ï¼Œçˆ¶çŠ¶æ€æœº<strong>è°ƒç”¨</strong>å­çŠ¶æ€æœºå¹¶é€šè¿‡ç›‘å¬å­çŠ¶æ€æœº<code>sendParent(...)</code>å‘é€çš„äº‹ä»¶ï¼Œæˆ–è€…ç­‰å¾…å­çŠ¶æ€æœºåˆ°è¾¾å…¶<a href="/docs/zh/guides/final.html">æœ€ç»ˆçŠ¶æ€ </a>ï¼Œè¿™å°†å¯¼è‡´è¿›è¡Œ<code>onDone</code>è½¬æ¢ã€‚</p> <p>ä½ å¯ä»¥è°ƒç”¨ï¼š</p> <ul><li><a href="#invoking-promises">Promises</a>, è¿™å°†åœ¨ <code>resolve</code> ä¸Šé‡‡ç”¨ <code>onDone</code> è½¬æ¢ï¼Œæˆ–è€…åœ¨ <code>reject</code> ä¸Šé‡‡ç”¨ <code>onError</code> è½¬æ¢</li> <li><a href="#invoking-callbacks">Callbacks</a>, å®ƒå¯ä»¥å‘çˆ¶çŠ¶æ€æœºå‘é€äº‹ä»¶å’Œä»çˆ¶çŠ¶æ€æœºæ¥æ”¶äº‹ä»¶</li> <li><a href="#invoking-observables">Observables</a>, å®ƒå¯ä»¥å‘çˆ¶çŠ¶æ€æœºå‘é€äº‹ä»¶ï¼Œä»¥åŠå®Œæˆæ—¶çš„ä¿¡å·</li> <li><a href="#invoking-machines">Machines</a>, å®ƒè¿˜å¯ä»¥å‘é€/æ¥æ”¶äº‹ä»¶ï¼Œå¹¶åœ¨è¾¾åˆ°<a href="/docs/zh/guides/final.html">æœ€ç»ˆçŠ¶æ€</a>æ—¶é€šçŸ¥çˆ¶çŠ¶æ€æœº</li></ul> <h2 id="invoke-å±æ€§"><a href="#invoke-å±æ€§" class="header-anchor">#</a> <code>invoke</code> å±æ€§</h2> <p>è°ƒç”¨æ˜¯åœ¨çŠ¶æ€èŠ‚ç‚¹çš„é…ç½®ä¸­ä½¿ç”¨ <code>invoke</code> å±æ€§å®šä¹‰çš„ï¼Œå…¶å€¼æ˜¯ä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„å¯¹è±¡ï¼š</p> <ul><li><code>src</code> - è¦è°ƒç”¨çš„æœåŠ¡çš„æ¥æºï¼Œå¯ä»¥æ˜¯ï¼š
<ul><li>çŠ¶æ€æœº</li> <li>ä¸€ä¸ªè¿”å› <code>Promise</code> çš„å‡½æ•°</li> <li>ä¸€ä¸ªè¿”å›â€œå›è°ƒå¤„ç†ç¨‹åºâ€çš„å‡½æ•°</li> <li>è¿”å›å¯è§‚å¯Ÿçš„å‡½æ•°</li> <li>ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒæŒ‡çš„æ˜¯åœ¨è¿™å°çŠ¶æ€æœºçš„ <code>options.services</code> ä¸­å®šä¹‰çš„ 4 ä¸ªåˆ—å‡ºçš„é€‰é¡¹ä¸­çš„ä»»ä½•ä¸€ä¸ª</li> <li>ä¸€ä¸ªè°ƒç”¨æºå¯¹è±¡ <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>4.12</span>ï¼Œå®ƒåŒ…å« <code>{ type: src }</code> ä¸­çš„æºå­—ç¬¦ä¸²ï¼Œä»¥åŠä»»ä½•å…¶ä»–å…ƒæ•°æ®ã€‚</li></ul></li> <li><code>id</code> - è¢«è°ƒç”¨æœåŠ¡çš„å”¯ä¸€æ ‡è¯†ç¬¦</li> <li><code>onDone</code> - ï¼ˆå¯é€‰ï¼‰åœ¨ä»¥ä¸‹æƒ…å†µä¸‹é‡‡ç”¨çš„ <a href="/docs/zh/guides/transitions.html">è½¬æ¢</a>ï¼š
<ul><li>å­çŠ¶æ€æœºè¾¾åˆ°å…¶ <a href="/docs/zh/guides/final.html">æœ€ç»ˆçŠ¶æ€</a>ï¼Œæˆ–</li> <li>è°ƒç”¨çš„ Promise çš„ resolveï¼Œæˆ–</li> <li>è¢«è°ƒç”¨çš„ observable å®Œæˆ</li></ul></li> <li><code>onError</code> - ï¼ˆå¯é€‰ï¼‰å½“è¢«è°ƒç”¨çš„æœåŠ¡é‡åˆ°æ‰§è¡Œé”™è¯¯æ—¶è¦è¿›è¡Œçš„è½¬æ¢ã€‚</li> <li><code>autoForward</code> - ï¼ˆå¯é€‰ï¼‰<code>true</code> å¦‚æœå‘é€åˆ°è¿™å°çŠ¶æ€æœºçš„æ‰€æœ‰äº‹ä»¶ä¹Ÿåº”è¯¥å‘é€ï¼ˆæˆ– <em>forwarded</em>ï¼‰åˆ°è¢«è°ƒç”¨çš„å­èŠ‚ç‚¹ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¸º <code>false</code>ï¼‰
<ul><li>âš ï¸ é¿å…å°† <code>autoForward</code> è®¾ç½®ä¸º <code>true</code>ï¼Œå› ä¸ºç›²ç›®è½¬å‘æ‰€æœ‰äº‹ä»¶å¯èƒ½ä¼šå¯¼è‡´æ„å¤–è¡Œä¸ºå’Œ/æˆ–æ— é™å¾ªç¯ã€‚ æ€»æ˜¯æ›´å–œæ¬¢æ˜¾å¼å‘é€äº‹ä»¶ï¼Œå’Œ/æˆ–ä½¿ç”¨ <code>forward(...)</code> åŠ¨ä½œåˆ›å»ºè€…ç›´æ¥å°†äº‹ä»¶è½¬å‘ç»™è¢«è°ƒç”¨çš„å­©å­ã€‚ ï¼ˆç›®å‰ä»…é€‚ç”¨äºçŠ¶æ€æœºï¼âš ï¸ï¼‰</li></ul></li> <li><code>data</code> - ï¼ˆå¯é€‰ï¼Œä»…åœ¨è°ƒç”¨çŠ¶æ€æœºæ—¶ä½¿ç”¨ï¼‰å°†å­çŠ¶æ€æœºçš„ <a href="/docs/zh/guides/context.html">context</a> çš„å±æ€§æ˜ å°„åˆ°ä»çˆ¶çŠ¶æ€æœºçš„ <code>context</code> è¿”å›ç›¸åº”å€¼çš„å‡½æ•°çš„å¯¹è±¡ã€‚</li></ul> <div class="custom-block warning"><p class="custom-block-title">æ³¨æ„</p> <p>ä¸è¦å°†çŠ¶æ€çš„ <code>onDone</code> å±æ€§ä¸ <code>invoke.onDone</code> æ··æ·†â€”â€”å®ƒä»¬æ˜¯ç±»ä¼¼çš„è½¬æ¢ï¼Œå®ƒä»¬æŒ‡çš„æ˜¯ä¸åŒçš„ä¸œè¥¿ã€‚</p> <ul><li><a href="/docs/zh/guides/statenodes.html">çŠ¶æ€èŠ‚ç‚¹</a> ä¸Šçš„<code>onDone</code> å±æ€§æŒ‡çš„æ˜¯å¤åˆçŠ¶æ€èŠ‚ç‚¹åˆ°è¾¾<a href="/docs/zh/guides/final.html">æœ€ç»ˆçŠ¶æ€</a>ã€‚</li> <li><code>invoke.onDone</code> å±æ€§æŒ‡çš„æ˜¯æ­£åœ¨å®Œæˆçš„è°ƒç”¨ (<code>invoke.src</code>)ã€‚</li></ul> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted">Â </div><br><br><br><br><br><br><br><div class="highlighted">Â </div><br><br><br></div><pre class="language-js"><code><span class="token comment">// ...</span>
loading<span class="token operator">:</span> <span class="token punctuation">{</span>
  invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
    src<span class="token operator">:</span> someSrc<span class="token punctuation">,</span>
    onDone<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">/* ... */</span><span class="token punctuation">}</span> <span class="token comment">// æŒ‡çš„æ˜¯ `someSrc` æ­£åœ¨å®Œæˆ</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  initial<span class="token operator">:</span> <span class="token string">'loadFoo'</span><span class="token punctuation">,</span>
  states<span class="token operator">:</span> <span class="token punctuation">{</span>
    loadFoo<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">/* ... */</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    loadBar<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">/* ... */</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    loadingComplete<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'final'</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  onDone<span class="token operator">:</span> <span class="token string">'loaded'</span> <span class="token comment">// æŒ‡çš„æ˜¯è¾¾åˆ°â€œloading.loadingCompleteâ€</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
</code></pre></div></div> <h2 id="è°ƒç”¨-promises"><a href="#è°ƒç”¨-promises" class="header-anchor">#</a> è°ƒç”¨ Promises</h2> <p>ç”±äºæ¯ä¸ª Promise éƒ½å¯ä»¥å»ºæ¨¡ä¸ºçŠ¶æ€æœºï¼Œå› æ­¤ XState å¯ä»¥æŒ‰åŸæ ·è°ƒç”¨ Promiseã€‚ Promise å¯ä»¥ï¼š</p> <ul><li><code>resolve()</code>, è¿™å°†é‡‡å–<code>onDone</code>è½¬æ¢</li> <li><code>reject()</code> ï¼ˆæˆ–æŠ›å‡ºé”™è¯¯ï¼‰ï¼Œè¿™å°†é‡‡ç”¨ <code>onError</code> è½¬æ¢</li></ul> <p>å¦‚æœåœ¨ Promise resolve ä¹‹å‰ï¼Œé€€å‡ºè¢«è°ƒç”¨çš„ Promise å¤„äºæ´»åŠ¨çŠ¶æ€çš„çŠ¶æ€ï¼Œåˆ™ Promise çš„ç»“æœå°†è¢«ä¸¢å¼ƒã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Function è¿”å› promise</span>
<span class="token comment">// è¿™ä¸ª promise å¯èƒ½ä¼š resolveï¼Œä¾‹å¦‚ï¼Œ</span>
<span class="token comment">// { name: 'David', location: 'Florida' }</span>
<span class="token keyword">const</span> <span class="token function-variable function">fetchUser</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">userId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">url/to/user/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> userMachine <span class="token operator">=</span> <span class="token function">createMachine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span>
  initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
  context<span class="token operator">:</span> <span class="token punctuation">{</span>
    userId<span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
    user<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
    error<span class="token operator">:</span> <span class="token keyword">undefined</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  states<span class="token operator">:</span> <span class="token punctuation">{</span>
    idle<span class="token operator">:</span> <span class="token punctuation">{</span>
      on<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token constant">FETCH</span><span class="token operator">:</span> <span class="token punctuation">{</span> target<span class="token operator">:</span> <span class="token string">'loading'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    loading<span class="token operator">:</span> <span class="token punctuation">{</span>
      invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token string">'getUser'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">src</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fetchUser</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>userId<span class="token punctuation">)</span><span class="token punctuation">,</span>
        onDone<span class="token operator">:</span> <span class="token punctuation">{</span>
          target<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
          actions<span class="token operator">:</span> <span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">user</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> event<span class="token punctuation">.</span>data <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        onError<span class="token operator">:</span> <span class="token punctuation">{</span>
          target<span class="token operator">:</span> <span class="token string">'failure'</span><span class="token punctuation">,</span>
          actions<span class="token operator">:</span> <span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> event<span class="token punctuation">.</span>data <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    success<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    failure<span class="token operator">:</span> <span class="token punctuation">{</span>
      on<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token constant">RETRY</span><span class="token operator">:</span> <span class="token punctuation">{</span> target<span class="token operator">:</span> <span class="token string">'loading'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>è§£æåçš„æ•°æ®è¢«æ”¾ç½®åœ¨ä¸€ä¸ª <code>'done.invoke.&lt;id&gt;'</code> äº‹ä»¶ä¸­ï¼Œåœ¨ <code>data</code> å±æ€§ä¸‹ï¼Œä¾‹å¦‚ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'done.invoke.getUser'</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'David'</span><span class="token punctuation">,</span>
    location<span class="token operator">:</span> <span class="token string">'Florida'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="promise-rejection"><a href="#promise-rejection" class="header-anchor">#</a> Promise Rejection</h3> <p>å¦‚æœ Promise æ‹’ç»ï¼Œåˆ™å°†ä½¿ç”¨ <code>{ type: 'error.platform' }</code> äº‹ä»¶è¿›è¡Œ <code>onError</code> è½¬æ¢ã€‚ é”™è¯¯æ•°æ®åœ¨äº‹ä»¶çš„ <code>data</code> å±æ€§ä¸­å¯ç”¨ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">search</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>event<span class="token punctuation">.</span>query<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'No query specified'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// or:</span>
    <span class="token comment">// throw new Error('No query specified');</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">getSearchResults</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>
<span class="token keyword">const</span> searchMachine <span class="token operator">=</span> <span class="token function">createMachine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'search'</span><span class="token punctuation">,</span>
  initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
  context<span class="token operator">:</span> <span class="token punctuation">{</span>
    results<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
    errorMessage<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  states<span class="token operator">:</span> <span class="token punctuation">{</span>
    idle<span class="token operator">:</span> <span class="token punctuation">{</span>
      on<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token constant">SEARCH</span><span class="token operator">:</span> <span class="token punctuation">{</span> target<span class="token operator">:</span> <span class="token string">'searching'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    searching<span class="token operator">:</span> <span class="token punctuation">{</span>
      invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token string">'search'</span><span class="token punctuation">,</span>
        src<span class="token operator">:</span> search<span class="token punctuation">,</span>
        onError<span class="token operator">:</span> <span class="token punctuation">{</span>
          target<span class="token operator">:</span> <span class="token string">'failure'</span><span class="token punctuation">,</span>
          actions<span class="token operator">:</span> <span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token function-variable function">errorMessage</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token comment">// event is:</span>
              <span class="token comment">// { type: 'error.platform', data: 'No query specified' }</span>
              <span class="token keyword">return</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        onDone<span class="token operator">:</span> <span class="token punctuation">{</span>
          target<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
          actions<span class="token operator">:</span> <span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">results</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> event<span class="token punctuation">.</span>data <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    success<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    failure<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">æ³¨æ„</p> <p>å¦‚æœç¼ºå°‘ <code>onError</code> è½¬æ¢å¹¶ä¸” Promise è¢«æ‹’ç»ï¼Œåˆ™é”™è¯¯å°†è¢«å¿½ç•¥ï¼Œé™¤éä½ ä¸ºçŠ¶æ€æœºæŒ‡å®šäº† <a href="/docs/zh/guides/machines.html#configuration">ä¸¥æ ¼æ¨¡å¼</a>ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸¥æ ¼æ¨¡å¼å°†åœæ­¢çŠ¶æ€æœºå¹¶æŠ›å‡ºé”™è¯¯ã€‚</p></div> <h2 id="è°ƒç”¨-callbacks"><a href="#è°ƒç”¨-callbacks" class="header-anchor">#</a> è°ƒç”¨ Callbacks</h2> <p>å‘é€åˆ°çˆ¶çŠ¶æ€æœºçš„äº‹ä»¶æµå¯ä»¥é€šè¿‡å›è°ƒå¤„ç†ç¨‹åºå»ºæ¨¡ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¥å—ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°ï¼š</p> <ul><li><code>callback</code> - ä½¿ç”¨è¦å‘é€çš„äº‹ä»¶è°ƒç”¨</li> <li><code>onReceive</code> - ä½¿ç”¨ <a href="#listening-to-parent-events">ç›‘å¬æ¥è‡ªçˆ¶çº§çš„äº‹ä»¶</a> çš„ç›‘å¬å™¨è°ƒç”¨</li></ul> <p>è¿”å›å€¼ï¼ˆå¯é€‰ï¼‰åº”è¯¥æ˜¯åœ¨é€€å‡ºå½“å‰çŠ¶æ€æ—¶ï¼Œå¯¹è°ƒç”¨çš„æœåŠ¡æ‰§è¡Œæ¸…ç†ï¼ˆå³å–æ¶ˆè®¢é˜…ã€é˜²æ­¢å†…å­˜æ³„æ¼ç­‰ï¼‰çš„å‡½æ•°ã€‚ å›è°ƒ <strong>ä¸èƒ½</strong> ä½¿ç”¨ <code>async/await</code> è¯­æ³•ï¼Œå› ä¸ºå®ƒä¼šè‡ªåŠ¨å°†è¿”å›å€¼åŒ…è£…åœ¨ <code>Promise</code> ä¸­ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ...</span>
counting<span class="token operator">:</span> <span class="token punctuation">{</span>
  invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'incInterval'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">src</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> onReceive</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// è¿™å°†æ¯ç§’å‘çˆ¶çº§å‘é€ 'INC' äº‹ä»¶</span>
      <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token string">'INC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// æ‰§è¡Œæ¸…ç†</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  on<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token constant">INC</span><span class="token operator">:</span> <span class="token punctuation">{</span> actions<span class="token operator">:</span> <span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">counter</span><span class="token operator">:</span> <span class="token parameter">context</span> <span class="token operator">=&gt;</span> context<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
</code></pre></div><h3 id="æ”¶å¬çˆ¶çº§äº‹ä»¶"><a href="#æ”¶å¬çˆ¶çº§äº‹ä»¶" class="header-anchor">#</a> æ”¶å¬çˆ¶çº§äº‹ä»¶</h3> <p>è¢«è°ƒç”¨çš„å›è°ƒå¤„ç†ç¨‹åºè¿˜è¢«èµ‹äºˆäº†ç¬¬äºŒä¸ªå‚æ•° <code>onReceive</code>ï¼Œå®ƒä¸ºä»çˆ¶çº§å‘é€åˆ°å›è°ƒå¤„ç†ç¨‹åºçš„äº‹ä»¶æ³¨å†Œç›‘å¬å™¨ã€‚ è¿™å…è®¸åœ¨çˆ¶çŠ¶æ€æœºå’Œè°ƒç”¨çš„å›è°ƒæœåŠ¡ä¹‹é—´è¿›è¡Œçˆ¶å­é€šä¿¡ã€‚</p> <p>ä¾‹å¦‚ï¼Œçˆ¶çŠ¶æ€æœºå‘å­ <code>'ponger'</code> æœåŠ¡å‘é€ <code>'PING'</code> äº‹ä»¶ã€‚ å­æœåŠ¡å¯ä»¥ä½¿ç”¨ <code>onReceive(listener)</code> ç›‘å¬è¯¥äº‹ä»¶ï¼Œå¹¶å°†ä¸€ä¸ª <code>'PONG'</code> äº‹ä»¶å‘é€å›çˆ¶çº§ä½œä¸ºå“åº”ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> pingPongMachine <span class="token operator">=</span> <span class="token function">createMachine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'pinger'</span><span class="token punctuation">,</span>
  initial<span class="token operator">:</span> <span class="token string">'active'</span><span class="token punctuation">,</span>
  states<span class="token operator">:</span> <span class="token punctuation">{</span>
    active<span class="token operator">:</span> <span class="token punctuation">{</span>
      invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token string">'ponger'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">src</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> onReceive</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// æ¯å½“çˆ¶çº§å‘é€â€œPINGâ€æ—¶ï¼Œ</span>
          <span class="token comment">// å‘é€çˆ¶'PONG'äº‹ä»¶</span>
          <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'PING'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token string">'PONG'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      entry<span class="token operator">:</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'PING'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> to<span class="token operator">:</span> <span class="token string">'ponger'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      on<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token constant">PONG</span><span class="token operator">:</span> <span class="token punctuation">{</span> target<span class="token operator">:</span> <span class="token string">'done'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    done<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'final'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">interpret</span><span class="token punctuation">(</span>pingPongMachine<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">onDone</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="è°ƒç”¨-observables"><a href="#è°ƒç”¨-observables" class="header-anchor">#</a> è°ƒç”¨ Observables <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>4.6</span></h2> <p><a href="https://github.com/tc39/proposal-observable" target="_blank" rel="noopener noreferrer">Observables<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ˜¯éšæ—¶é—´å‘å‡ºçš„å€¼æµã€‚ å°†å®ƒä»¬è§†ä¸ºä¸€ä¸ªæ•°ç»„/é›†åˆï¼Œå…¶å€¼æ˜¯å¼‚æ­¥å‘å‡ºçš„ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡å‘å‡ºã€‚ JavaScript ä¸­æœ‰è®¸å¤š observable çš„å®ç°ï¼› æœ€å—æ¬¢è¿çš„æ˜¯ <a href="https://github.com/ReactiveX/rxjs" target="_blank" rel="noopener noreferrer">RxJS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <p>å¯ä»¥è°ƒç”¨ Observablesï¼Œå®ƒåº”è¯¥å‘çˆ¶çŠ¶æ€æœºå‘é€äº‹ä»¶ï¼ˆå­—ç¬¦ä¸²æˆ–å¯¹è±¡ï¼‰ï¼Œä½†ä¸æ¥æ”¶äº‹ä»¶ï¼ˆå•å‘ï¼‰ã€‚ ä¸€ä¸ª observable è°ƒç”¨æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä»¥ <code>context</code> å’Œ <code>event</code> ä½œä¸ºå‚æ•°å¹¶è¿”å›ä¸€ä¸ªå¯è§‚å¯Ÿçš„äº‹ä»¶æµã€‚ å½“é€€å‡ºè°ƒç”¨å®ƒçš„çŠ¶æ€æ—¶ï¼Œobservable è¢«å–æ¶ˆè®¢é˜…ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createMachine<span class="token punctuation">,</span> interpret <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'xstate'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> interval <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> map<span class="token punctuation">,</span> take <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> intervalMachine <span class="token operator">=</span> <span class="token function">createMachine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'interval'</span><span class="token punctuation">,</span>
  initial<span class="token operator">:</span> <span class="token string">'counting'</span><span class="token punctuation">,</span>
  context<span class="token operator">:</span> <span class="token punctuation">{</span> myInterval<span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  states<span class="token operator">:</span> <span class="token punctuation">{</span>
    counting<span class="token operator">:</span> <span class="token punctuation">{</span>
      invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">src</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
          <span class="token function">interval</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>myInterval<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
            <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'COUNT'</span><span class="token punctuation">,</span> value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">take</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        onDone<span class="token operator">:</span> <span class="token string">'finished'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      on<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token constant">COUNT</span><span class="token operator">:</span> <span class="token punctuation">{</span> actions<span class="token operator">:</span> <span class="token string">'notifyCount'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token constant">CANCEL</span><span class="token operator">:</span> <span class="token punctuation">{</span> target<span class="token operator">:</span> <span class="token string">'finished'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    finished<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'final'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ä¸Šé¢çš„<code>intervalMachine</code> å°†æ¥æ”¶æ¥è‡ª<code>interval(...)</code> æ˜ å°„åˆ°äº‹ä»¶å¯¹è±¡çš„äº‹ä»¶ï¼Œç›´åˆ°å¯è§‚å¯Ÿå¯¹è±¡â€œå®Œæˆâ€ï¼ˆå®Œæˆå‘å°„å€¼ï¼‰ã€‚ å¦‚æœ <code>&quot;CANCEL&quot;</code> äº‹ä»¶å‘ç”Ÿï¼Œobservable å°†è¢«å¤„ç†ï¼ˆ<code>.unsubscribe()</code> å°†åœ¨å†…éƒ¨è°ƒç”¨ï¼‰ã€‚</p> <div class="custom-block tip"><p class="custom-block-title">æç¤º</p> <p>ä¸ä¸€å®šéœ€è¦ä¸ºæ¯æ¬¡è°ƒç”¨éƒ½åˆ›å»º Observableã€‚ å¯ä»¥æ”¹ä¸ºå¼•ç”¨â€œçƒ­å¯è§‚å¯Ÿâ€ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> fromEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mouseMove$ <span class="token operator">=</span> <span class="token function">fromEvent</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token string">'mousemove'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mouseMachine <span class="token operator">=</span> <span class="token function">createMachine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'mouse'</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
  invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">src</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> mouseMove$
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  on<span class="token operator">:</span> <span class="token punctuation">{</span>
    mousemove<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">/* ... */</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <h2 id="è°ƒç”¨-machines"><a href="#è°ƒç”¨-machines" class="header-anchor">#</a> è°ƒç”¨ Machines</h2> <p>çŠ¶æ€æœºåˆ†å±‚é€šä¿¡ï¼Œè¢«è°ƒç”¨çš„çŠ¶æ€æœºå¯ä»¥é€šä¿¡ï¼š</p> <ul><li>é€šè¿‡<code>send(EVENT, { to: 'someChildId' })</code> åŠ¨ä½œå®ç°çˆ¶åˆ°å­</li> <li>é€šè¿‡ <code>sendParent(EVENT)</code> æ“ä½œå®ç°å­çº§åˆ°çˆ¶çº§ã€‚</li></ul> <p>å¦‚æœé€€å‡ºè°ƒç”¨çŠ¶æ€æœºçš„çŠ¶æ€ï¼Œåˆ™çŠ¶æ€æœºåœæ­¢ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createMachine<span class="token punctuation">,</span> interpret<span class="token punctuation">,</span> send<span class="token punctuation">,</span> sendParent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'xstate'</span><span class="token punctuation">;</span>

<span class="token comment">// è°ƒç”¨å­çŠ¶æ€æœº</span>
<span class="token keyword">const</span> minuteMachine <span class="token operator">=</span> <span class="token function">createMachine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'timer'</span><span class="token punctuation">,</span>
  initial<span class="token operator">:</span> <span class="token string">'active'</span><span class="token punctuation">,</span>
  states<span class="token operator">:</span> <span class="token punctuation">{</span>
    active<span class="token operator">:</span> <span class="token punctuation">{</span>
      after<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token number">60000</span><span class="token operator">:</span> <span class="token punctuation">{</span> target<span class="token operator">:</span> <span class="token string">'finished'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    finished<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'final'</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> parentMachine <span class="token operator">=</span> <span class="token function">createMachine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'parent'</span><span class="token punctuation">,</span>
  initial<span class="token operator">:</span> <span class="token string">'pending'</span><span class="token punctuation">,</span>
  states<span class="token operator">:</span> <span class="token punctuation">{</span>
    pending<span class="token operator">:</span> <span class="token punctuation">{</span>
      invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
        src<span class="token operator">:</span> minuteMachine<span class="token punctuation">,</span>
        <span class="token comment">// å½“ minuteMachine è¾¾åˆ°å…¶é¡¶çº§æœ€ç»ˆçŠ¶æ€æ—¶ï¼Œå°†è¿›è¡Œ onDone è½¬æ¢ã€‚</span>
        onDone<span class="token operator">:</span> <span class="token string">'timesUp'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    timesUp<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'final'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> service <span class="token operator">=</span> <span class="token function">interpret</span><span class="token punctuation">(</span>parentMachine<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">onTransition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; 'pending'</span>
<span class="token comment">// ... after 1 minute</span>
<span class="token comment">// =&gt; 'timesUp'</span>
</code></pre></div><h3 id="ä½¿ç”¨-context-è°ƒç”¨"><a href="#ä½¿ç”¨-context-è°ƒç”¨" class="header-anchor">#</a> ä½¿ç”¨ Context è°ƒç”¨</h3> <p>å­çŠ¶æ€æœºå¯ä»¥ä½¿ç”¨ä»çˆ¶çŠ¶æ€æœºçš„ <code>context</code> å’Œ <code>data</code> å±æ€§æ´¾ç”Ÿçš„ <code>context</code> è°ƒç”¨ã€‚ ä¾‹å¦‚ï¼Œä¸‹é¢çš„<code>parentMachine</code> å°†è°ƒç”¨ä¸€ä¸ªæ–°çš„<code>timerMachine</code> æœåŠ¡ï¼Œåˆå§‹ä¸Šä¸‹æ–‡ä¸º<code>{duration: 3000 }</code>ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> timerMachine <span class="token operator">=</span> <span class="token function">createMachine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'timer'</span><span class="token punctuation">,</span>
  context<span class="token operator">:</span> <span class="token punctuation">{</span>
    duration<span class="token operator">:</span> <span class="token number">1000</span> <span class="token comment">// é»˜è®¤ duration</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> parentMachine <span class="token operator">=</span> <span class="token function">createMachine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'parent'</span><span class="token punctuation">,</span>
  initial<span class="token operator">:</span> <span class="token string">'active'</span><span class="token punctuation">,</span>
  context<span class="token operator">:</span> <span class="token punctuation">{</span>
    customDuration<span class="token operator">:</span> <span class="token number">3000</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  states<span class="token operator">:</span> <span class="token punctuation">{</span>
    active<span class="token operator">:</span> <span class="token punctuation">{</span>
      invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token string">'timer'</span><span class="token punctuation">,</span>
        src<span class="token operator">:</span> timerMachine<span class="token punctuation">,</span>
        <span class="token comment">// ä»çˆ¶ä¸Šä¸‹æ–‡ æ´¾ç”Ÿå­ä¸Šä¸‹æ–‡</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token function-variable function">duration</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> context<span class="token punctuation">.</span>customDuration
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>å°±åƒ <a href="/docs/zh/guides/context.html"><code>assign(...)</code></a> ä¸€æ ·ï¼Œå­ä¸Šä¸‹æ–‡å¯ä»¥æ˜ å°„ä¸ºå¯¹è±¡ï¼ˆé¦–é€‰ï¼‰æˆ–å‡½æ•°ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// å¯¹è±¡ï¼ˆæ¯ä¸ªå±æ€§ï¼‰ï¼š</span>
data<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">duration</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> context<span class="token punctuation">.</span>customDuration<span class="token punctuation">,</span>
  <span class="token function-variable function">foo</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> event<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token string">'static value'</span>
<span class="token punctuation">}</span>

<span class="token comment">// å‡½æ•°ï¼ˆèšåˆï¼‰ï¼Œç›¸å½“äºä¸Šé¢çš„ï¼š</span>
<span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  duration<span class="token operator">:</span> context<span class="token punctuation">.</span>customDuration<span class="token punctuation">,</span>
  foo<span class="token operator">:</span> event<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token string">'static value'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">æ³¨æ„</p> <p><code>data</code> <em>æ›¿æ¢</em> çŠ¶æ€æœºä¸Šå®šä¹‰çš„é»˜è®¤<code>context</code>ï¼› å®ƒæ²¡æœ‰åˆå¹¶ã€‚ æ­¤è¡Œä¸ºå°†åœ¨ä¸‹ä¸€ä¸ªä¸»è¦ç‰ˆæœ¬ä¸­æ›´æ”¹ã€‚</p></div> <h3 id="å®Œæˆæ•°æ®"><a href="#å®Œæˆæ•°æ®" class="header-anchor">#</a> å®Œæˆæ•°æ®</h3> <p>å½“å­çŠ¶æ€æœºåˆ°è¾¾å…¶é¡¶çº§<a href="/docs/zh/guides/final.html">æœ€ç»ˆçŠ¶æ€</a>æ—¶ï¼Œå®ƒå¯ä»¥åœ¨â€œdoneâ€äº‹ä»¶ä¸­å‘é€æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œ<code>{ type: 'done.invoke.someId', data: .. .}</code>ï¼‰ã€‚ è¿™ä¸ªâ€œå®Œæˆçš„æ•°æ®â€æ˜¯åœ¨æœ€ç»ˆçŠ¶æ€çš„<code>data</code>å±æ€§ä¸ŠæŒ‡å®šçš„ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> secretMachine <span class="token operator">=</span> <span class="token function">createMachine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'secret'</span><span class="token punctuation">,</span>
  initial<span class="token operator">:</span> <span class="token string">'wait'</span><span class="token punctuation">,</span>
  context<span class="token operator">:</span> <span class="token punctuation">{</span>
    secret<span class="token operator">:</span> <span class="token string">'42'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  states<span class="token operator">:</span> <span class="token punctuation">{</span>
    wait<span class="token operator">:</span> <span class="token punctuation">{</span>
      after<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token number">1000</span><span class="token operator">:</span> <span class="token punctuation">{</span> target<span class="token operator">:</span> <span class="token string">'reveal'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    reveal<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'final'</span><span class="token punctuation">,</span>
      data<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">secret</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> context<span class="token punctuation">.</span>secret
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> parentMachine <span class="token operator">=</span> <span class="token function">createMachine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'parent'</span><span class="token punctuation">,</span>
  initial<span class="token operator">:</span> <span class="token string">'pending'</span><span class="token punctuation">,</span>
  context<span class="token operator">:</span> <span class="token punctuation">{</span>
    revealedSecret<span class="token operator">:</span> <span class="token keyword">undefined</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  states<span class="token operator">:</span> <span class="token punctuation">{</span>
    pending<span class="token operator">:</span> <span class="token punctuation">{</span>
      invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token string">'secret'</span><span class="token punctuation">,</span>
        src<span class="token operator">:</span> secretMachine<span class="token punctuation">,</span>
        onDone<span class="token operator">:</span> <span class="token punctuation">{</span>
          target<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
          actions<span class="token operator">:</span> <span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token function-variable function">revealedSecret</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token comment">// event is:</span>
              <span class="token comment">// { type: 'done.invoke.secret', data: { secret: '42' } }</span>
              <span class="token keyword">return</span> event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>secret<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    success<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'final'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> service <span class="token operator">=</span> <span class="token function">interpret</span><span class="token punctuation">(</span>parentMachine<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">onTransition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; { revealedSecret: undefined }</span>
<span class="token comment">// ...</span>
<span class="token comment">// =&gt; { revealedSecret: '42' }</span>
</code></pre></div><h3 id="å‘é€äº‹ä»¶"><a href="#å‘é€äº‹ä»¶" class="header-anchor">#</a> å‘é€äº‹ä»¶</h3> <ul><li>è¦ä» <strong>å­</strong> çŠ¶æ€æœºå‘é€åˆ° <strong>çˆ¶</strong> çŠ¶æ€æœºï¼Œè¯·ä½¿ç”¨ <code>sendParent(event)</code>ï¼ˆé‡‡ç”¨ä¸ <code>send(...)</code> ç›¸åŒçš„å‚æ•°ï¼‰</li> <li>è¦ä» <strong>çˆ¶</strong> çŠ¶æ€æœºå‘é€åˆ° <strong>å­</strong> çŠ¶æ€æœºï¼Œè¯·ä½¿ç”¨ <code>send(event, { to: &lt;child ID&gt; })</code></li></ul> <div class="custom-block warning"><p class="custom-block-title">æ³¨æ„</p> <p><code>send(...)</code> å’Œ <code>sendParent(...)</code> åŠ¨ä½œ åˆ›å»ºè€… <em>ä¸æ˜¯</em> å‘½ä»¤å¼å‘çŠ¶æ€æœºå‘é€äº‹ä»¶ã€‚ å®ƒä»¬æ˜¯è¿”å›åŠ¨ä½œå¯¹è±¡çš„çº¯å‡½æ•°
æè¿°è¦å‘é€çš„å†…å®¹ï¼Œä¾‹å¦‚ï¼Œ<code>{ type: 'xstate.send', event: ... }</code>ã€‚ <a href="/docs/zh/guides/interpretation.html">è§£é‡Šï¼ˆinterpretï¼‰</a> å°†è¯»å–è¿™äº›å¯¹è±¡ï¼Œç„¶åå‘é€å®ƒä»¬ã€‚</p> <p><a href="/docs/guides/actions.html#send-action">é˜…è¯»æœ‰å…³<code>send</code>çš„æ›´å¤šä¿¡æ¯</a></p></div> <p>ä¸‹é¢æ˜¯ä¸¤å°çŠ¶æ€æœº <code>pingMachine</code> å’Œ <code>pongMachine</code> ç›¸äº’é€šä¿¡çš„ä¾‹å­ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createMachine<span class="token punctuation">,</span> interpret<span class="token punctuation">,</span> send<span class="token punctuation">,</span> sendParent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'xstate'</span><span class="token punctuation">;</span>

<span class="token comment">// çˆ¶çŠ¶æ€æœº</span>
<span class="token keyword">const</span> pingMachine <span class="token operator">=</span> <span class="token function">createMachine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'ping'</span><span class="token punctuation">,</span>
  initial<span class="token operator">:</span> <span class="token string">'active'</span><span class="token punctuation">,</span>
  states<span class="token operator">:</span> <span class="token punctuation">{</span>
    active<span class="token operator">:</span> <span class="token punctuation">{</span>
      invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token string">'pong'</span><span class="token punctuation">,</span>
        src<span class="token operator">:</span> pongMachine
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// å°†â€œPINGâ€äº‹ä»¶å‘é€åˆ° ID ä¸ºâ€œpongâ€çš„å­çŠ¶æ€æœº</span>
      entry<span class="token operator">:</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'PING'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> to<span class="token operator">:</span> <span class="token string">'pong'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      on<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token constant">PONG</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          actions<span class="token operator">:</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'PING'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> to<span class="token operator">:</span> <span class="token string">'pong'</span><span class="token punctuation">,</span> delay<span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è°ƒç”¨å­çŠ¶æ€æœº</span>
<span class="token keyword">const</span> pongMachine <span class="token operator">=</span> <span class="token function">createMachine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'pong'</span><span class="token punctuation">,</span>
  initial<span class="token operator">:</span> <span class="token string">'active'</span><span class="token punctuation">,</span>
  states<span class="token operator">:</span> <span class="token punctuation">{</span>
    active<span class="token operator">:</span> <span class="token punctuation">{</span>
      on<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token constant">PING</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// å‘çˆ¶çŠ¶æ€æœºå‘é€â€œPONGâ€äº‹ä»¶</span>
          actions<span class="token operator">:</span> <span class="token function">sendParent</span><span class="token punctuation">(</span><span class="token string">'PONG'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            delay<span class="token operator">:</span> <span class="token number">1000</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> service <span class="token operator">=</span> <span class="token function">interpret</span><span class="token punctuation">(</span>pingMachine<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// =&gt; 'ping'</span>
<span class="token comment">// ...</span>
<span class="token comment">// =&gt; 'pong'</span>
<span class="token comment">// ..</span>
<span class="token comment">// =&gt; 'ping'</span>
<span class="token comment">// ...</span>
<span class="token comment">// =&gt; 'pong'</span>
<span class="token comment">// ...</span>
</code></pre></div><h2 id="å‘é€å“åº”"><a href="#å‘é€å“åº”" class="header-anchor">#</a> å‘é€å“åº” <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>4.7+</span></h2> <p>è¢«è°ƒç”¨çš„æœåŠ¡ï¼ˆæˆ– <a href="/docs/zh/guides/actors.html">åˆ›å»ºçš„ æ¼”å‘˜</a>ï¼‰å¯ä»¥ <em>å“åº”</em> å¦ä¸€ä¸ª æœåŠ¡/æ¼”å‘˜ï¼› å³ï¼Œå®ƒå¯ä»¥å‘é€äº‹ä»¶ <em>å“åº”</em> å¦ä¸€ä¸ª æœåŠ¡/æ¼”å‘˜ å‘é€çš„äº‹ä»¶ã€‚ è¿™æ˜¯é€šè¿‡ <code>respond(...)</code> åŠ¨ä½œ åˆ›å»ºè€…å®Œæˆçš„ã€‚</p> <p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„ <code>'client'</code> çŠ¶æ€æœºå°† <code>'CODE'</code> äº‹ä»¶å‘é€åˆ°è°ƒç”¨çš„ <code>'auth-server'</code> æœåŠ¡ï¼Œç„¶ååœ¨ 1 ç§’åå“åº” <code>'TOKEN'</code> äº‹ä»¶ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createMachine<span class="token punctuation">,</span> send<span class="token punctuation">,</span> actions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'xstate'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> respond <span class="token punctuation">}</span> <span class="token operator">=</span> actions<span class="token punctuation">;</span>

<span class="token keyword">const</span> authServerMachine <span class="token operator">=</span> <span class="token function">createMachine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'server'</span><span class="token punctuation">,</span>
  initial<span class="token operator">:</span> <span class="token string">'waitingForCode'</span><span class="token punctuation">,</span>
  states<span class="token operator">:</span> <span class="token punctuation">{</span>
    waitingForCode<span class="token operator">:</span> <span class="token punctuation">{</span>
      on<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token constant">CODE</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          actions<span class="token operator">:</span> <span class="token function">respond</span><span class="token punctuation">(</span><span class="token string">'TOKEN'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> delay<span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> authClientMachine <span class="token operator">=</span> <span class="token function">createMachine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'client'</span><span class="token punctuation">,</span>
  initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
  states<span class="token operator">:</span> <span class="token punctuation">{</span>
    idle<span class="token operator">:</span> <span class="token punctuation">{</span>
      on<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token constant">AUTH</span><span class="token operator">:</span> <span class="token punctuation">{</span> target<span class="token operator">:</span> <span class="token string">'authorizing'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    authorizing<span class="token operator">:</span> <span class="token punctuation">{</span>
      invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token string">'auth-server'</span><span class="token punctuation">,</span>
        src<span class="token operator">:</span> authServerMachine
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      entry<span class="token operator">:</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'CODE'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> to<span class="token operator">:</span> <span class="token string">'auth-server'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      on<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token constant">TOKEN</span><span class="token operator">:</span> <span class="token punctuation">{</span> target<span class="token operator">:</span> <span class="token string">'authorized'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    authorized<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'final'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>è¿™ä¸ªç‰¹å®šçš„ä¾‹å­å¯ä»¥ä½¿ç”¨ <code>sendParent(...)</code> æ¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœï¼› ä¸åŒä¹‹å¤„åœ¨äº <code>respond(...)</code> ä¼šå°†ä¸€ä¸ªäº‹ä»¶å‘é€å›æ¥æ”¶åˆ°çš„äº‹ä»¶çš„æ¥æºï¼Œå®ƒå¯èƒ½ä¸ä¸€å®šæ˜¯çˆ¶çŠ¶æ€æœºã€‚</p> <h2 id="å¤šæœåŠ¡"><a href="#å¤šæœåŠ¡" class="header-anchor">#</a> å¤šæœåŠ¡</h2> <p>ä½ å¯ä»¥é€šè¿‡åœ¨æ•°ç»„ä¸­æŒ‡å®šæ¯ä¸ªæœåŠ¡æ¥è°ƒç”¨å¤šä¸ªæœåŠ¡ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ...</span>
invoke<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'service1'</span><span class="token punctuation">,</span> src<span class="token operator">:</span> <span class="token string">'someService'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'service2'</span><span class="token punctuation">,</span> src<span class="token operator">:</span> <span class="token string">'someService'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'logService'</span><span class="token punctuation">,</span> src<span class="token operator">:</span> <span class="token string">'logService'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token comment">// ...</span>
</code></pre></div><p>æ¯æ¬¡è°ƒç”¨éƒ½ä¼šåˆ›å»ºè¯¥æœåŠ¡çš„ <em>æ–°</em> å®ä¾‹ï¼Œå› æ­¤å³ä½¿å¤šä¸ªæœåŠ¡çš„ <code>src</code> ç›¸åŒï¼ˆä¾‹å¦‚ï¼Œä¸Šé¢çš„ <code>'someService'</code>ï¼‰ï¼Œä¹Ÿä¼šè°ƒç”¨å¤šä¸ª <code>'someService'</code> çš„å®ä¾‹ã€‚</p> <h2 id="é…ç½®æœåŠ¡"><a href="#é…ç½®æœåŠ¡" class="header-anchor">#</a> é…ç½®æœåŠ¡</h2> <p>è°ƒç”¨æºï¼ˆæœåŠ¡ï¼‰çš„é…ç½®æ–¹å¼ç±»ä¼¼äºåŠ¨ä½œã€å®ˆå«ç­‰çš„é…ç½®æ–¹å¼ï¼Œé€šè¿‡å°† <code>src</code> æŒ‡å®šä¸ºå­—ç¬¦ä¸²å¹¶åœ¨ Machine é€‰é¡¹çš„ <code>services</code> å±æ€§ä¸­å®šä¹‰å®ƒä»¬ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fetchUser <span class="token operator">=</span> <span class="token comment">// (å’Œä¸Šé¢ä¾‹å­ç›¸åŒ)</span>

<span class="token keyword">const</span> userMachine <span class="token operator">=</span> <span class="token function">createMachine</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
    states<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      loading<span class="token operator">:</span> <span class="token punctuation">{</span>
        invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
          src<span class="token operator">:</span> <span class="token string">'getUser'</span><span class="token punctuation">,</span>
          <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
  services<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">getUser</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fetchUser</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>è°ƒç”¨ <code>src</code> ä¹Ÿå¯ä»¥æŒ‡å®šä¸ºä¸€ä¸ªå¯¹è±¡ <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>4.12</span>ï¼Œå®ƒç”¨å®ƒçš„ <code>type</code> å’Œå…¶ä»–ç›¸å…³çš„å…ƒæ•°æ®æ¥æè¿°è°ƒç”¨æºã€‚ è¿™å¯ä»¥ä» <code>meta.src</code> å‚æ•°ä¸­çš„ <code>services</code> é€‰é¡¹ä¸­è¯»å–ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> machine <span class="token operator">=</span> <span class="token function">createMachine</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    initial<span class="token operator">:</span> <span class="token string">'searching'</span><span class="token punctuation">,</span>
    states<span class="token operator">:</span> <span class="token punctuation">{</span>
      searching<span class="token operator">:</span> <span class="token punctuation">{</span>
        invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
          src<span class="token operator">:</span> <span class="token punctuation">{</span>
            type<span class="token operator">:</span> <span class="token string">'search'</span><span class="token punctuation">,</span>
            endpoint<span class="token operator">:</span> <span class="token string">'example.com'</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    services<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">search</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event<span class="token punctuation">,</span> <span class="token punctuation">{</span> src <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// =&gt; { endpoint: 'example.com' }</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="header-anchor">#</a> æµ‹è¯•</h2> <p>é€šè¿‡å°†æœåŠ¡æŒ‡å®šä¸ºä¸Šé¢çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ <code>.withConfig()</code> æŒ‡å®šæ›¿ä»£å®ç°æ¥å®Œæˆâ€œæ¨¡æ‹Ÿâ€æœåŠ¡ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> interpret <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'xstate'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> assert <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'chai'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> userMachine <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../path/to/userMachine'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">mockFetchUser</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">userId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// æ¨¡æ‹Ÿä»»ä½•ä½ æƒ³è¦çš„ï¼Œä½†ç¡®ä¿ä½¿ç”¨ç›¸åŒçš„è¡Œä¸ºå’Œå“åº”æ ¼å¼</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Test'</span><span class="token punctuation">,</span> location<span class="token operator">:</span> <span class="token string">'Anywhere'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> testUserMachine <span class="token operator">=</span> userMachine<span class="token punctuation">.</span><span class="token function">withConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  services<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">getUser</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">mockFetchUser</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'userMachine'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should go to the &quot;success&quot; state when a user is found'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">interpret</span><span class="token punctuation">(</span>testUserMachine<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">onTransition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          assert<span class="token punctuation">.</span><span class="token function">deepEqual</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>context<span class="token punctuation">.</span>user<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">'Test'</span><span class="token punctuation">,</span>
            location<span class="token operator">:</span> <span class="token string">'Anywhere'</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="å¼•ç”¨æœåŠ¡"><a href="#å¼•ç”¨æœåŠ¡" class="header-anchor">#</a> å¼•ç”¨æœåŠ¡ <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>4.7+</span></h2> <p>æœåŠ¡ï¼ˆå’Œ <a href="/docs/zh/guides/actors.html">æ¼”å‘˜</a>ï¼Œå®ƒä»¬æ˜¯è¡ç”Ÿçš„æœåŠ¡ï¼‰å¯ä»¥ä» <code>.children</code> å±æ€§ç›´æ¥åœ¨ <a href="/docs/zh/guides/states.html">çŠ¶æ€å¯¹è±¡</a> ä¸Šå¼•ç”¨ã€‚ <code>state.children</code> å¯¹è±¡æ˜¯æœåŠ¡ IDï¼ˆé”®ï¼‰åˆ°è¿™äº›æœåŠ¡å®ä¾‹ï¼ˆå€¼ï¼‰çš„æ˜ å°„ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> machine <span class="token operator">=</span> <span class="token function">createMachine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  invoke<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'notifier'</span><span class="token punctuation">,</span> src<span class="token operator">:</span> createNotifier <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'logger'</span><span class="token punctuation">,</span> src<span class="token operator">:</span> createLogger <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> service <span class="token operator">=</span> <span class="token function">interpret</span><span class="token punctuation">(</span>machine<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">onTransition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>children<span class="token punctuation">.</span>notifier<span class="token punctuation">;</span> <span class="token comment">// æ¥è‡ª createNotifier() çš„æœåŠ¡</span>
    state<span class="token punctuation">.</span>children<span class="token punctuation">.</span>logger<span class="token punctuation">;</span> <span class="token comment">// æ¥è‡ª createLogger() çš„æœåŠ¡</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>å½“ JSON åºåˆ—åŒ–æ—¶ï¼Œ<code>state.children</code> å¯¹è±¡æ˜¯æœåŠ¡ IDï¼ˆé”®ï¼‰åˆ°åŒ…å«æœ‰å…³è¯¥æœåŠ¡çš„å…ƒæ•°æ®çš„å¯¹è±¡çš„æ˜ å°„ã€‚</p> <h2 id="å¿«é€Ÿå‚è€ƒ"><a href="#å¿«é€Ÿå‚è€ƒ" class="header-anchor">#</a> å¿«é€Ÿå‚è€ƒ</h2> <p><strong><code>invoke</code> å±æ€§</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> machine <span class="token operator">=</span> <span class="token function">createMachine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  states<span class="token operator">:</span> <span class="token punctuation">{</span>
    someState<span class="token operator">:</span> <span class="token punctuation">{</span>
      invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// `src` å±æ€§å¯ä»¥æ˜¯ï¼š</span>
        <span class="token comment">// - a string</span>
        <span class="token comment">// - a machine</span>
        <span class="token comment">// - a function that returns...</span>
        <span class="token function-variable function">src</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// - a promise</span>
          <span class="token comment">// - a callback handler</span>
          <span class="token comment">// - an observable</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        id<span class="token operator">:</span> <span class="token string">'some-id'</span><span class="token punctuation">,</span>
        <span class="token comment">//ï¼ˆå¯é€‰ï¼‰å°†çŠ¶æ€æœºäº‹ä»¶è½¬å‘åˆ°è¢«è°ƒç”¨çš„æœåŠ¡ï¼ˆç›®å‰ä»…é€‚ç”¨äºçŠ¶æ€æœºï¼ï¼‰</span>
        autoForward<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">//ï¼ˆå¯é€‰ï¼‰è°ƒç”¨çš„promise/observable/machineå®Œæˆæ—¶çš„è½¬æ¢</span>
        onDone<span class="token operator">:</span> <span class="token punctuation">{</span> target<span class="token operator">:</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// ï¼ˆå¯é€‰ï¼‰å½“è¢«è°ƒç”¨çš„æœåŠ¡å‘ç”Ÿé”™è¯¯æ—¶çš„è½¬æ¢</span>
        onError<span class="token operator">:</span> <span class="token punctuation">{</span> target<span class="token operator">:</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>è°ƒç”¨ Promises</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// è¿”å› Promise çš„å‡½æ•°</span>
<span class="token keyword">const</span> <span class="token function-variable function">getDataFromAPI</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> data<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// ...</span>
<span class="token punctuation">{</span>
  <span class="token function-variable function">invoke</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> getDataFromAPI<span class="token punctuation">,</span>
  <span class="token comment">// resolved promise</span>
  onDone<span class="token operator">:</span> <span class="token punctuation">{</span>
    target<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
    <span class="token comment">// resolve promise æ•°æ®ä½äº event.data å±æ€§ä¸Š</span>
    <span class="token function-variable function">actions</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// rejected promise</span>
  onError<span class="token operator">:</span> <span class="token punctuation">{</span>
    target<span class="token operator">:</span> <span class="token string">'failure'</span><span class="token punctuation">,</span>
    <span class="token comment">// rejected promise æ•°æ®ä½äº event.data å±æ€§ä¸Š</span>
    <span class="token function-variable function">actions</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
</code></pre></div><p><strong>è°ƒç”¨ Callbacks</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ...</span>
<span class="token punctuation">{</span>
  <span class="token function-variable function">invoke</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> onReceive</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// å°†äº‹ä»¶å‘é€å›çˆ¶çº§</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'SOME_EVENT'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ¥æ”¶æ¥è‡ªçˆ¶çº§çš„äº‹ä»¶</span>
    <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'DO_SOMETHING'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// callback é”™è¯¯</span>
  onError<span class="token operator">:</span> <span class="token punctuation">{</span>
    target<span class="token operator">:</span> <span class="token string">'failure'</span><span class="token punctuation">,</span>
    <span class="token comment">// é”™è¯¯æ•°æ®ä½äº event.data å±æ€§ä¸Š</span>
    <span class="token function-variable function">actions</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
on<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token constant">SOME_EVENT</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>è°ƒç”¨ Observables</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> map <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>
<span class="token punctuation">{</span>
  invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">src</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">createSomeObservable</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'SOME_EVENT'</span><span class="token punctuation">,</span> value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    onDone<span class="token operator">:</span> <span class="token string">'finished'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
on<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token constant">SOME_EVENT</span><span class="token operator">:</span> <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
</code></pre></div><p><strong>è°ƒç”¨ çŠ¶æ€æœº</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> someMachine <span class="token operator">=</span> <span class="token function">createMachine</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>
<span class="token punctuation">{</span>
  invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
    src<span class="token operator">:</span> someMachine<span class="token punctuation">,</span>
    onDone<span class="token operator">:</span> <span class="token punctuation">{</span>
      target<span class="token operator">:</span> <span class="token string">'finished'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">actions</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// å­çŠ¶æ€æœºçš„å®Œæˆæ•°æ®ï¼ˆå…¶æœ€ç»ˆçŠ¶æ€çš„ .data å±æ€§ï¼‰</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/davidkpiano/xstate/edit/main/docs/zh/guides/communication.md" target="_blank" rel="noopener noreferrer">åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2023/3/2 21:37:47</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/docs/zh/guides/activities.html" class="prev">
        æ´»åŠ¨ Activities
      </a></span> <span class="next"><a href="/docs/zh/guides/actors.html">
        æ¼”å‘˜ Actors
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.b1166240.js" defer></script><script src="/docs/assets/js/3.0f500953.js" defer></script><script src="/docs/assets/js/12.91d2277e.js" defer></script><script src="/docs/assets/js/175.dde208a1.js" defer></script><script src="/docs/assets/js/13.849ee94d.js" defer></script>
  </body>
</html>
